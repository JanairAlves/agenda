unit uVContato;

interface

uses
  Winapi.Windows, Winapi.Messages, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.ExtCtrls, Vcl.StdCtrls, uCContato,
  Datasnap.DBClient;

type
  TfVContato = class(TForm)
    edtNome: TEdit;
    lbNome: TLabel;
    lbSobrenome: TLabel;
    edtSobrenome: TEdit;
    edtApelido: TEdit;
    lbApelido: TLabel;
    edtDataNascimento: TEdit;
    lbNascimento: TLabel;
    btEndereco: TButton;
    btTelefone: TButton;
    btRedeSocial: TButton;
    cbRelacionamento: TComboBox;
    lbRelacionamento: TLabel;
    pnRodape: TPanel;
    pnCentral: TPanel;
    pnBotoesAcoes: TPanel;
    btSalvar: TButton;
    btLimpar: TButton;
    btFechar: TButton;
    procedure btLimparClick(Sender: TObject);
    procedure btFecharClick(Sender: TObject);
    procedure btSalvarClick(Sender: TObject);
  private
    { Private declarations }
    FCContato: TCContato;
    procedure LimparCampos;
    procedure AtribuirValoresContato(var ocdsContato: TClientDataSet);
    function MontarDataSetContato: TClientDataSet;
    procedure ExibirMensagem(mensagem: string);
  public
    { Public declarations }
    constructor Create(AOwner: TComponent); override;
    destructor Destroy; override;
  end;

var
  fVContato: TfVContato;

implementation

uses
  System.SysUtils, System.Generics.Collections, Data.DB;

{$R *.dfm}

{ TfrmViewContato }

procedure TfVContato.AtribuirValoresContato(var ocdsContato: TClientDataSet);
begin
  ocdsContato.Edit;
  ocdsContato.FieldByName('Nome').AsString := edtNome.Text;
  ocdsContato.FieldByName('Sobrenome').AsString := edtSobrenome.Text;
  ocdsContato.FieldByName('Apelido').AsString := edtApelido.Text;
  ocdsContato.FieldByName('Nascimento').AsDateTime := StrToDate(edtDataNascimento.Text);
  ocdsContato.FieldByName('Relacionamento').AsString := cbRelacionamento.Text;
  ocdsContato.Post;
end;

procedure TfVContato.btFecharClick(Sender: TObject);
begin
  Close;
end;

procedure TfVContato.btLimparClick(Sender: TObject);
begin
  LimparCampos;
end;

procedure TfVContato.btSalvarClick(Sender: TObject);
var
  ocdsContato: TClientDataSet;
begin
  ocdsContato := MontarDataSetContato;
  AtribuirValoresContato(ocdsContato);

  try
    FCContato.SalvarContato(ocdsContato);
  finally
    LimparCampos;
    FreeAndNil(ocdsContato);
  end;
end;

constructor TfVContato.Create(AOwner: TComponent);
begin
  inherited Create(AOwner);

  if not assigned(FCContato) then
    FCContato := TCContato.Create(ExibirMensagem);
end;

function TfVContato.MontarDataSetContato: TClientDataSet;
begin
  result := TClientDataSet.Create(nil);

  result.Close;
  result.FieldDefs.Clear;
  result.FieldDefs.Add('Nome', ftString, 50);
  result.FieldDefs.Add('Sobrenome', ftString, 100);
  result.FieldDefs.Add('Apelido', ftString, 50);
  result.FieldDefs.Add('Nascimento', ftDate);
  result.FieldDefs.Add('Relacionamento', ftString, 10);
  result.CreateDataSet;
end;

destructor TfVContato.Destroy;
begin
  inherited;
  FreeAndNil(FCContato);
end;

procedure TfVContato.ExibirMensagem(mensagem: string);
begin
  ShowMessage('Erro: ' + mensagem);
  LimparCampos;
end;

procedure TfVContato.LimparCampos;
begin
  edtNome.Text := '';
  edtSobrenome.Text := '';
  edtApelido.Text := '';
  edtDataNascimento.Text := '';
  cbRelacionamento.ItemIndex := 3;
end;

end.

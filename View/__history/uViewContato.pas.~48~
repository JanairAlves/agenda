unit uViewContato;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.ExtCtrls, Vcl.StdCtrls, uControllerContato,
  System.Generics.Collections;

type
  TfVContato = class(TForm)
    edtNome: TEdit;
    lbNome: TLabel;
    lbSobrenome: TLabel;
    edtSobrenome: TEdit;
    edtApelido: TEdit;
    lbApelido: TLabel;
    edtDataNascimento: TEdit;
    lbNascimento: TLabel;
    btEndereco: TButton;
    btTelefone: TButton;
    btRedeSocial: TButton;
    cbRelacionamento: TComboBox;
    lbRelacionamento: TLabel;
    pnRodape: TPanel;
    pnCentral: TPanel;
    pnBotoesAcoes: TPanel;
    btSalvar: TButton;
    btLimpar: TButton;
    btFechar: TButton;
    procedure btLimparClick(Sender: TObject);
    procedure btFecharClick(Sender: TObject);
    procedure btSalvarClick(Sender: TObject);
  private
    { Private declarations }
    FControllerContato: TCContato;
    FModelContato: TMContato;
    procedure LimparCampos;
    procedure MontarDicionarioContato;
  public
    { Public declarations }
    procedure ExibirErro(msg: string);
    constructor Create;
    destructor Destroy; override;
  end;

var
  fViewContato: TfVContato;

implementation

{$R *.dfm}

{ TfrmViewContato }

procedure TfVContato.btFecharClick(Sender: TObject);
begin
  Close;
end;

procedure TfVContato.btLimparClick(Sender: TObject);
begin
  LimparCampos;
end;

procedure TfVContato.btSalvarClick(Sender: TObject);
begin
  MontarDicionarioContato;

  if not FControllerContato.SalvarContato(FModelContato) then
  begin
    ExibirErro();
    Exit;
  end;

  FModelContato := nil;
  LimparCampos;
end;

constructor TfVContato.Create;
begin
  if not assigned(FControllerContato) then
    FControllerContato := TCContato.Create;

  if  assigned(FModelContato) then
    FModelContato := TMContato.Create;
end;

procedure TfVContato.MontarDicionarioContato;
begin
  FModelContato.Nome := edtNome.Text;
  FModelContato.Sobrenome := edtSobrenome.Text;
  FModelContato.Apelido := edtApelido.Text;
  FModelContato.Nascimento := edtDataNascimento.Text;
  FModelContato.Relacionamento := cbRelacionamento.ItemIndex;
end;

destructor TfVContato.Destroy;
begin
  FreeAndNil(FControllerContato);
  FreeAndNil(FModelContato);
  inherited;
end;

procedure TfVContato.ExibirErro(msg: string);
begin
  ShowMessage('Erro: ' + msg);
end;

procedure TfVContato.LimparCampos;
begin
  edtNome.Text := '';
  edtSobrenome.Text := '';
  edtApelido.Text := '';
  edtDataNascimento.Text := '';
  cbRelacionamento.ItemIndex := 3;
end;

end.

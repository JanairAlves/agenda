unit uViewContato;

interface

uses
  Winapi.Windows, Winapi.Messages, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.ExtCtrls, Vcl.StdCtrls, uControllerContato,
  System.Generics.Collections, uModelContato;

type
  TfVContato = class(TForm)
    edtNome: TEdit;
    lbNome: TLabel;
    lbSobrenome: TLabel;
    edtSobrenome: TEdit;
    edtApelido: TEdit;
    lbApelido: TLabel;
    edtDataNascimento: TEdit;
    lbNascimento: TLabel;
    btEndereco: TButton;
    btTelefone: TButton;
    btRedeSocial: TButton;
    cbRelacionamento: TComboBox;
    lbRelacionamento: TLabel;
    pnRodape: TPanel;
    pnCentral: TPanel;
    pnBotoesAcoes: TPanel;
    btSalvar: TButton;
    btLimpar: TButton;
    btFechar: TButton;
    procedure btLimparClick(Sender: TObject);
    procedure btFecharClick(Sender: TObject);
    procedure btSalvarClick(Sender: TObject);
  private
    { Private declarations }
    FCContato: TCContato;
    FMContato: TMContato;
    procedure LimparCampos;
    procedure MontarDicionarioContato;
  public
    { Public declarations }
    procedure ExibirErro(msg: string);
    constructor Create;
    destructor Destroy; override;
  end;

var
  fVContato: TfVContato;

implementation

uses
  System.SysUtils;

{$R *.dfm}

{ TfrmViewContato }

procedure TfVContato.btFecharClick(Sender: TObject);
begin
  Close;
end;

procedure TfVContato.btLimparClick(Sender: TObject);
begin
  LimparCampos;
end;

procedure TfVContato.btSalvarClick(Sender: TObject);
begin
  MontarDicionarioContato;

  if not FCContato.SalvarContato(FMContato) then
  begin
    ExibirErro();
    Exit;
  end;

  FMContato := nil;
  LimparCampos;
end;

constructor TfVContato.Create;
begin
  if not assigned(FCContato) then
    FCContato := TCContato.Create;

  if  assigned(FMContato) then
    FMContato := TMContato.Create;
end;

procedure TfVContato.MontarDicionarioContato;
begin
  FMContato.Nome := edtNome.Text;
  FMContato.Sobrenome := edtSobrenome.Text;
  FMContato.Apelido := edtApelido.Text;
  FMContato.Nascimento := edtDataNascimento.Text;
  FMContato.Relacionamento := cbRelacionamento.Text;
end;

destructor TfVContato.Destroy;
begin
  FreeAndNil(FCContato);
  FreeAndNil(FMContato);
  inherited;
end;

procedure TfVContato.ExibirErro(msg: string);
begin
  ShowMessage('Erro: ' + msg);
end;

procedure TfVContato.LimparCampos;
begin
  edtNome.Text := '';
  edtSobrenome.Text := '';
  edtApelido.Text := '';
  edtDataNascimento.Text := '';
  cbRelacionamento.ItemIndex := 3;
end;

end.
